### 背景
近期着手了一个新的项目，在产品业务的设计中，其中一个核心是工作流。涉及到的一个核心的技术是工作流。

### 本文目标
深化技术选型的规范，并最终给出一个解决方案。

### 技术选型原则
1. 深化需求。
了解产品业务背景，以及业务的后续发展的需求，决定开源框架选择的必要性。
2. 技术调研
现在社区发达，往往同一个技术类别就会有多个开源的技术框架。针对不同的技术框架首页应该考虑的是技术的成熟程度，以及社区的发展。其次，如果多个类似的开源框架都较为成熟，则需要考虑其融入现有应用的成本，技术学习成本，与现有技术的融入成本等。
3. 成本考虑
在公司做事，成本往往是一件至关重要的因素，完成一个开源框架的搭建，融入现有应用实现该有的业务需要多少人员成本，以及后期维护成本，都需要做好考量。


### 选型分析
##### 业务工作流分析
1. 可以灵活的配置，支持web页面的拖拽，勾选去除
2. 每一个节点可以进行自定义实现方式

##### 技术调研
现在较为成熟的工作流引擎是JBPM，Activiti。其中JBPM是加入的JBOSS，现在最为成熟的工作流。但是后续发展中，出现分歧延伸到activiti，JBPM两个产品。


### jBPM与Activiti比较 

##### 发展历史
jBPM3是一个完整的工作流系统实现，面向开发人员，目的在于简化对组织核心流程进行支撑的软件创建，不支持标准。提供了以下的组件基于Eclipse的流程设计器、用于监控案例（流程实例）和处理任务的Web控制台以及jPDL核心库。

jBPM4引入PVM，使其拥有更强大的扩展性，同时增加BPMS特性，这些特性包括了对BPMN的支持、面向业务人员的Web建模器和简单统计分析功能的加入。

jBPM5基于原先的Drools Flow，支持BPMN，通过与Drools的合并支持BAM，通过内容仓库增加对流程可视化的支持。由于放弃了jBPM4的PVM，引擎的可扩展性受到损害，并且不再支持jPDL。

Activiti5基于jBPM4，与Alfresco的集成增加了其流程可视化与管理能力，同时通过创新的Activiti Cycle协作组件支持流程相关人员之间的协调，最后，它加强了集成能力。

##### github热度比较

jbmp  star：556   fork：739®
activiti   stark：1808   fork：1795

##### 技术支持比较
|技术点|    Activiti |   jBPM5
|---|---|---|
数据库持久层ORM|   MyBatis3 |   Hibernate3
持久化标准|   无   |JPA规范
事务管理|    MyBatis机制/Spring事务控制|    Bitronix，基于JTA事务管理
数据库连接方式| Jdbc/DataSource |Jdbc/DataSource
支持数据库|   Oracle、SQL Server、MySQL等多数数据库  | Oracle、SQL Server、MySQL等多数数据库
设计模式|    Command模式、观察者模式等   |  
内部服务通讯|  Service间通过API调用 |基于Apache Mina异步通讯
集成接口|    SOAP、Mule、RESTful  | 消息通讯
支持的流程格式| BPMN2、xPDL、jPDL等   | 目前仅只支持BPMN2 xml
引擎核心|    PVM（流程虚拟机） | Drools
技术前身|    jBPM3、jBPM4 |Drools Flow

##### 综合比较
jBPM5
基于原先的Drools Flow，支持BPMN，通过与Drools的合并支持BAM，通过内容仓库增加对流程可视化的支持。由于放弃了jBPM4的PVM，引擎的可扩展性受到损害，并且不再支持jPDL。

Activiti5
基于jBPM4，基于PVM，增加了其流程可视化与管理能力，同时通过创新的ActivitiCycle协作组件支持流程相关人员之间的协调，最后，它加强了集成能力。
activiti5代码规范更为合理，也更容易上手。从jbmp3，4迁移过来的开发人员，开源社区更为活跃。


### 选型
业务需求。只是简单支持简单的可配置的工作流。两种工作流都可以支持，jbpm采用了Apache Mina通讯，但是对于工作流都是内部应用体现不出优势。同时jbpm对于规则引擎也有更好的支持，现在activiti已经支持了drools的调用。
从人力成本。维护成本来讲。activiti更为轻量级，更容易上手，开源社区更大，activiti优势。
技术栈成本。activiti采用了spring管理实务，mybatis做ORM，与现在应用中技术栈相同，成本有优势。

最终结论选择activiti

