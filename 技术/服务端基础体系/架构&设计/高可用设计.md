信贷风控SaaS服务，服务的客户群体是银行、消金等金融公司，在客户贷款审批和贷后监控环节，通过实时计算、并行计算、机器学习等技术手段为客户提供智能决策SaaS服务。金融场景任何线上问题，客户敏感度都会比较高，轻则影响到客户业务流程，重则为客户带来直接的经济损失。因此高可用建设一直是技术团队重中之重的工作。信贷风控服务，是以数据为基础，并基于数据加工模型，衍生变量，策略等，为客户提供决策或者决策依据，因此数据输出质量也是服务质量的核心因素。
### 一、系统可用性保障
过去十年互联网业务蓬勃的发展，相应的技术体系也得到快速发展，尤其是分布式架构技术体系，海量数据的存储/计算，目前的基础技术体系在可用性层面都有比较成熟的设计和考量，其次互联网公司业务可用性也作为一个比较核心的指标，在研发流程，风险控制等可用性建设体系层面也有比较成熟的积累。
《SRE-Google运维解密》
蚂蚁超大规模分布式系统稳定性体系实践
高可用建设的另外一个角度是降低导致不可用的风险，常见的风险项：服务器宕机，磁盘损坏，专线挖断，客户流量徒增，代码发布等等，如何和针对以上风险点如果做高可用建设工作？主备、容灾、限流、灰度发布等措施。本文从风险管理和针对风险的建设工作角度来阐述如何进行高可用建设。
#### 1.1 拥抱风险
风险是无处不在的，首先我们系统服务的环境是不断变化的，本身我们系统服务是不断的升级迭代的，其次我们系统服务不会是一个完全自闭的系统，作为服务提供方，客户使用不会是一成不变的，作为服务使用方，我们依赖的外部系统、基建、供应商等也不会一成不变的。这些变化必然会带来风险。其次，即便假定我们系统服务不再升级迭代，及没有任何变化，我们客户和服务商也没有任何变化，从熵定律来讲，没有外力做功情况下，系统也逐渐趋向混乱，例如相关物理设备都会老化趋向于不可用。
既然风险是无处不在的，那我们应该乐观拥抱风险，把风险当作工作中的日常，并进行系统化管理。
##### 度量风险
度量风险标准做法是通过一个客观指标来体现，例如请求成功率：系统正常响应个数/响应总数，基于时间的可用性：系统正常运行时间/系统运行总时间，基于客户影响角度的客户影响数量，赔款金额，基于批处理任务的处理成功率等。
我们可以通过客观指标评价系统的表现以及追踪一段时间内的改进和退步，为每项服务设定度量指标，每周/每月进行跟踪，通过寻找偏差，并通过调整使服务达到一个高层次目标。
##### 风险容忍度
不同的产品/服务对于风险容忍度是不同的，技术人员必须与产品负责人一起努力，将一组商业目标转化为明确的可以实现的工程目标。可以从以下几个角度考虑：
● 用户期望的服务水平是什么？
● 这项服务是否直接关系到收入？
● 如果市场上有竞争对手，竞争对手提供的服务水平如何？
产品研发的绩效是如何很大程度通过产品研发速度体现的，这会激励员工尽可能快地创建新的代码。同时，SRE 的绩效表现取决于该服务的可靠性，这意味着SRE 会对高频率的更改提出抗议，需要通过控制测试质量、发布频率、灰度时间等保持可靠性。双方的平衡可以通过定义一个双方都同意的客观指标，该指标可以用来指导谈判的方向。
##### 稳定性目标
如果不详细了解服务中各种行为的重要程度，并且不去度量这些行为的正确性的话，就无法正确运维这个系统，更不要说可靠地运维了
SLI：是指服务质量指标（indicator）—该服务的某项服务质量的一个具体量化指标。常见的SLI包括错误率（请求处理失败的百分比）、系统吞吐量（每秒请求数量）等。
SLO：是服务质量目标（Objective）：服务的某个SLI的目标值，或者目标范围。SLO的定义是SLI≤目标值，或者范围下限≤SLI≤范围上限。
SLA：是服务质量协议（Agreement）：指服务与用户之间的一个明确的，或者不明确的协议，描述了在达到或者没有达到SLO之后的后果。
##### 风险事件处理
##### 紧急事件响应
紧急事件响应，第一优先级永远是先止损，没有几个人天生就能很好处理紧急情况，需要进行实战训练，如果建立了一套应急处理流程，那会更容易处理。
无效事件响应流程：过于关注技术问题、沟通不畅、未经评估的修改。
紧急事故的流程管理要素：事故总控、事务处理团队、发言人、规划负责人；控制中心、实时事故状态文档、明确公开的职责交接；
##### 事后总结
事后总结的主要目的是为了保证该事故被记录下来，理清所有的根源性问题，同时最关键的是，确保实施有效的措施使得未来重现的几率和影响得到降低，甚至避免重现。书写事后总结不是一种惩罚措施，而是整个公司的一次学习机会。一篇事后总结必须重点关注如何定位造成这次事件的根本问题，而不是指责某个人或某团队的错误或者不恰当的举动。
事后总结可以采用5W分析法明确故障的根因，并有针对性的改进措施。后续改进措施，可以遵循PDCA、5W2H工作法，任务执行。
建立事后总结文化，鼓励对事不对人，引入流程，奖励制度。

##### 管理制度：OnCall
制度：7*24小时OnCall制度，主要从流程层面提高故障响应效率，提升事后风险分析质量。
  ○ 7*24小时OnCall制度，保证及时故障响应效率；
  ○ 值班组长/副组长，作为故障第一响应人，不仅可以把故障指定到具体业务线责任人及时处理，也可以防止故障处理人员在故障处理过程中没有对外沟通/跨团队沟通等导致信息不同步、故障处理效率低等问题；
  ○ 业务值班人，作为故障处理负责人，只需要及时响应故障，并把处理信息同步。
  ○ 统一作战，防止因为信息不同步，导致故障解决效率低或者引发更大的故障；
OnCall制度，不仅仅在故障响应层面负责，需要对故障记录，事后分析，等有统一的规范标准，并对标准和后续改进计划负责。
##### 谷歌的SRE工程师
谷歌有专门的SRE工程师，本质上来讲SRE就是在用软件工程的思维和方法论完成以前由系统管理员团队手动完成的任务，SRE团队要承担以下几类职责：可用性改进，延迟优化，性能优化，效率优化，变更管理，监控，紧急事务处理以及容量规划与管理。
#### 1.2 风险解决方案
#####灾备
#####异地多活
#####发布过程
历史经验，大多数故障都是业务变更，线上发布引起。因此合理的发布策略，可以降低线上故障发生概率。发布过程参考阿里的三板斧：可监控、可灰度、可回滚。
可监控
监控的话主要纬度业务监控、日志监控、基础监控、全链路监控
● 业务监控：从业务自身角度对业务运营状况做相应的监控。
● 性能监控：主要包括三个维度：PV、状态码、响应时间、容量，并从保证链路的上下游、核心逻辑都能做到如上维度的监控，在状态码的设计中，可以有公司统一完善的规则，在监考触发报警时，可以根据状态码第一时间准确的定位问题点。
● 日志监控：主要对线上错误日志做监控告警。
● 基础监控：包括CPU、磁盘、内存、GC、网络流量等。
可灰度
灰度发布方案主要有金丝雀发布、蓝绿发布、灰度发布。可以根据业务场景设计响应的发布过程。
可回滚
回滚可以分为三个层面，应用回滚、代码中设置回滚开关、配置/SQL回滚，无论哪种方式，在发布前响应的回滚方案都需要有明确的设计。
##### 研发质量
研发质量可以参考蚂蚁高可用建设白皮书，并严格管控研发过程：需求评审、详细设计、研发、CR、测试、STG验证、流量比对。
##### 应对故障
预案
##### 基建稳定性
基建稳定性建设在此不详细描述，不过在与基建沟通过程中，需要确保每个基建的SLA，并根据基建的SLA和自己业务对可用性要求，有相应的选择和应对措施。
### 二、数据质量保障
#### 数据质量衡量标准
● 完整性：指数据的记录和信息是否完整，是否存在缺失的情况。数据缺失主要包括记录的缺失和记录中某个字段信息的缺失，两者都会造成统计结果不准确，所以说完整性是数据质量最基础的保障。在做监控时，需要考虑两个方面：数据条数是否少了；某些字段的取值是否缺失。完整性的监控，多出现在日志级别的监控上，一般会在数据接入的时候来做数据完整性校验。
● 准确性：指数据中记录的信息和数据是否准确，是否存在异常或者错误。一般准确性的监控多集中在对业务结果数据的监控，比如每日的活跃、收入等数据是否正常。
● 一致性：指同一指标在不同地方的结果是否一致。数据不一致的情况，多出现在数据系统达到一定的复杂度后，同一指标会在多处进行计算，由于计算口径或者开发人员的不同，容易造成同一指标出现不同的结果。
● 及时性：在确保数据的完整性、准确性和一致性后，接下来就要保障数据能够及时产出，这样才能体现数据的价值。及时性很容易理解，主要就是数据计算出来的速度是否够快，这点在数据质量监控中可以体现在监控结果数据是否在指定时间点前计算完成。
● 规范性：指数据是否按照要求的规则进行存储，如类型、格式、取值范围等，具有一定的语义意义。
● 唯一性：指数据是否有重复，如字段的唯一值、字段的重复值等。
#### 灰度上线
离线任务上线流程，跟实时类似，需要具备灰度功能，灰度方式可以通过一致性比对的方式。通过与线上任务一致性比对，如果结果有变化，可以通过数据分析每日分析监控。
#### 质量监控
通过DQC规则对数据质量进行监控，可以根据监控结果指定后续措施：通过、告警&人工处理、告警等；