本文主要是《重构-改善既有代码的设计》的读书笔记，主要关注在理论篇，对于具体的方法论没有具体的阐述，为什么呢？重构2这本书出版这么多年，其实很多方法论理念已经集成在我们日常的工具、编码规范中，本文主要关心作者的一些思想理念。
### 理解重构
#### 概念
重构（名词）： 对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。  
重构（动词）： 使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。
在过去的几十年时间里，重构这个词似乎被用来代指任何形式的代码清理，但上面的定义所指的是一种特定的清理代码的方式。重构的关键在于运用大量微小且保持软件行为的步骤，一步一步达成大规模的修改。

#### 与性能优化的区别
重构与性能优化有很多相似的地方：两者都需要修改代码，并且两者都不会改变程序的整体功能。

两者的差别在于起目的：
* 重构是为了让代码 “更容易理解，更容易修改”。这可能使程序运行得更快，也可能使程序运行的更慢。
* 性能优化则只关心程序是否运行的更快。对于最终得到的代码是否容易理解和维护就不知道了。

#### 为什么重构
重构不是包治百病的灵药，也绝对不是所谓的“银弹”。重构只是一种工具，能够帮助你始终良好的控制代码而已。使用它，可能基于下面的几个目的：
1. 改进软件设计
   >为了短期目的的修改代码，忽略代码的设计，代码越来越腐败。实际上设计欠佳的程序往往需要更多的代码，因为会存在大量的重复代码。因此消除重复代码，确保所有事务和行为在代码中只表述一次，是优秀设计的根本。
2. 使软件更容易理解
   >程序语言本身是与计算机对话，明确的告诉计算机我想要做什么，计算机按照指令精确的行动。其次，代码还会有其它读者，而且需要后续读者的维护。因此好的设计需要“准确告诉计算机我想要的”和“清晰的告诉后续读者我在做什么”。在开发维护过程中用重构，保持代码可读可理解性，清晰表达代码意图，非常重要。
3. 帮助找到BUG
   >重构可以加深对于代码和程序结构的理解，bug那么就更容易发现。

4. 提高编程速度  
   
   重构可能会花大量时间改善设计、提高阅读性、修改bug，难道不是在降低开发速度吗？实际上随着时间的推移低质量的代码添加新功能，耗费的时间会更多。
   > 代码库看起来就像补丁摞补丁，需要细致的考古工作才能弄明白整个系统是如何工作的。这份负担不断拖慢新增功能的速度，到最后程序员恨不得从头开始重写整个系统。  

   保持重构，好的设计，理想情况下，代码库会逐步演化成一个平台，在其上可以很容易地构造与其领域相关的新功能。
   > 这种现象被作者称为“设计耐久性假说”：通过投入精力改善内部设计，我们增加了软件的耐久性，从而可以更长时间地保持开发的快速。目前还无法科学地证明这个理论，所以说它是一个“假说”。

#### 重构时机
重构本来就不是一件应该特别拨出时间做的事情，重构应该随时随地进行。你不应该为重构而重构，你之所以重构，是因为你想做别的什么事，而重构可以帮助你把那些事做好。
1. 事不过三
   >第一次做某些事情时，只管去做，第二次做类似的事情会反感，无论如何还是可以去做；第三次再做类似的事，你就应该重构

2. 添加新功能时重构
   >在动手添加新功能时，如果现有的代码结构做一些微调，会使得工作容易很多，那么重构一下代码，轻松添加新功能。
3. 理解代码时
   >在修改代码之前，会先去阅读代码，在阅读代码时往往会看到很多糟糕的设计，糟糕的命名等，在这些小细节上做重构，使代码变得更清晰。
4. 复审代码时
    > 代码评审对于编写清晰代码很重要，也会让更多人有机会提出更多的建议。


#### 重构安排
1. 捡垃圾式重构
   >日常工作中，发现一些可以重构的代码，如果马上可以完成可以立即重构，但是如果需要花费一些精力，现在任务又比较紧急，可以把手上任务先完成。把重构事情记录下来，任务完成后再做重构。这些垃圾代码重构可能需要几个小时，也可能需要几天，甚至几个月。积少成多，垃圾满满会被清理干净。
2. 有计划的重构和见机行事的重构
   >上述我们提到的重构，都是见机行事，在添加功能，修改代码时顺便完成。"重构不是与编程割裂的行为"，在日常代码撰写中顺其自然完成的。“添加新功能最快的方法往往是先修改现有的代码，使新功能容易被加入”。

   >不过并不表示一切重构都是见机行事的，如果在重构上花费一个星期，一个月，会在未来发挥价值。那么我们需要计划立项，专门花时间来解决某些领域的问题。
3. 长期重构
    >大多数重构可以在几分钟—最多几小时—内完成。但有一些大型的重构可能要花上几个星期，例如要替换一个正在使用的库，或者将整块代码抽取到一个组件中并共享给另一支团队使用，再或者要处理一大堆混乱的依赖关系，等等。即便在这样的情况下，我仍然不愿让一支团队专门做重构。可以让整个团队达成共识，在未来几周时间里逐步解决这个问题，这经常是一个有效的策略。